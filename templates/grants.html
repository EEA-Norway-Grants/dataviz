{% extends "dataviz.html" %}

{% block top %}
{% endblock %}

{% block main %}
<div class="lg-column">

  <div class="grant-dataviz" id="financial-mechanisms">
  <h2>Funding by financial mechanism</h2>
    <mechanisms
        :initial="dataset"
    />
  </div>

  <div class="grant-dataviz" id="priority-sectors">
  <h2>Allocation by priority sector</h2>
    <sectors
        :initial="dataset"
    />
  </div>
</div>

<div class="lg-column">
  <div class="grant-dataviz" id="funding-map">
  <h2>Funding map</h2>
    <xmap
        :initial="dataset"
        details-datasource="{% url "api:beneficiary-allocation-detail" "XX" %}"
    />
  </div>

  <div class="grant-dataviz" id="beneficiary-states">
  <h2>Funding across beneficiary states</h2>
    <beneficiaries
        :initial="dataset"
    />
  </div>
</div>
{% endblock %}

{% block aside %}
<div class="sidebar">
  <sidebar
      :initial="dataset">
    <!-- this entire part is the sidebar's slot... -->
  </sidebar>
    <tabs>
      <tab name="Results">
        <results
        :initial="dataset" />
      </tab>
      <tab name="Programmes">
        <programmes
        :initial="dataset" />
      </tab>
    </tabs>
 </div>
    <!-- ...end slot -->
{% endblock %}

{% block finally %}
<script>
new root.Grants({
  el: '#content',
  data: {
    datasource: "{% url "api:grants" %}"
  },
});
</script>
<script>
// expand function for sidebar on mobile
if (window.matchMedia("(max-width: 768px)").matches) {
  let sidebar = document.querySelector('.sidebar');
  sidebar.addEventListener('click', function(e){
    let close_button = this.querySelector('#close-sidebar .icon');
    if (e.target == close_button) {
     this.classList.remove('is-expanded-on-mobile');
    }
    else {
      this.classList.add('is-expanded-on-mobile');
    }
  })
}

</script>
{% endblock %}
